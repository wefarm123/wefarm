<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WEFARM Tech Tools</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <!-- Header / Hero -->
  <section class="py-5 bg-success text-white text-center">
    <div class="container">
      <h1 class="display-4">WEFARM Tech Tools</h1>
      <p class="lead">AI se empowered smart farming tools for our Kisans üåæ</p>
    </div>
  </section>

  <!-- Crop Planner Tool -->
<section class="py-5" id="crop-planner">
  <div class="container">
    <h2 class="text-center mb-4">üå± AI Crop Planning Tool</h2>
    <p class="text-center mb-5">Kisaan bhaiyo! Yeh tool aapke farm ke liye best crop plan suggest karega based on season, soil aur mandi rates.</p>

    <form id="cropPlannerForm" class="row g-3 justify-content-center">
      <div class="col-md-3">
        <label class="form-label">Location</label>
        <input type="text" class="form-control" id="location" placeholder="e.g., Patna, Bihar" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Season</label>
        <select class="form-select" id="season" required>
          <option value="">Choose...</option>
          <option>Rabi</option>
          <option>Kharif</option>
          <option>Zaid</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Soil Type</label>
        <select class="form-select" id="soil" required>
          <option value="">Choose...</option>
          <option>Alluvial</option>
          <option>Black</option>
          <option>Red</option>
          <option>Laterite</option>
          <option>Sandy</option>
          <option>Clay</option>
        </select>
      </div>
      <div class="col-md-12 text-center">
        <button type="submit" class="btn btn-success btn-lg">üöÄ Suggest Crops</button>
      </div>
    </form>

    <div id="cropResults" class="mt-5 text-center" style="display:none;">
      <h4>üåæ Suggested Crops:</h4>
      <p id="suggestionText" class="lead mt-3"></p>
    </div>
  </div>
</section>

<script>
  const cropSuggestions = {
    "Rabi": {
      "Alluvial": ["Wheat", "Mustard", "Barley"],
      "Black": ["Chickpea", "Lentil", "Wheat"],
      "Red": ["Wheat", "Mustard"],
      "Laterite": ["Pea", "Mustard"],
      "Sandy": ["Carrot", "Onion"],
      "Clay": ["Wheat", "Barley"]
    },
    "Kharif": {
      "Alluvial": ["Paddy", "Maize", "Cotton"],
      "Black": ["Soybean", "Pigeon Pea", "Cotton"],
      "Red": ["Millets", "Groundnut"],
      "Laterite": ["Paddy", "Sesame"],
      "Sandy": ["Moong", "Bajra"],
      "Clay": ["Paddy", "Maize"]
    },
    "Zaid": {
      "Alluvial": ["Watermelon", "Cucumber"],
      "Black": ["Sunflower", "Moong"],
      "Red": ["Melon", "Pumpkin"],
      "Laterite": ["Cucumber", "Gourd"],
      "Sandy": ["Watermelon", "Muskmelon"],
      "Clay": ["Cucumber", "Bitter Gourd"]
    }
  };

  document.getElementById("cropPlannerForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const season = document.getElementById("season").value;
    const soil = document.getElementById("soil").value;
    const crops = cropSuggestions[season]?.[soil] || ["Data unavailable. Try different inputs."];

    document.getElementById("suggestionText").innerText = crops.join(", ");
    document.getElementById("cropResults").style.display = "block";
  });
</script>

<!-- Crop Doctor Tool -->
<section class="py-5 bg-light" id="crop-doctor">
  <div class="container text-center">
    <h2>üßë‚Äç‚öïÔ∏è AI Crop Doctor</h2>
    <p class="mb-4">Apne faslon ka health check-up karein! Yeh AI tool symptoms ke basis par disease identify karega aur treatment suggest karega.</p>

    <form id="cropDoctorForm" class="row g-3 justify-content-center">
      <div class="col-md-4">
        <label class="form-label">Vegetable</label>
        <select class="form-select" id="vegetable" required>
          <option value="">Choose...</option>
          <option>Tomato</option>
          <option>Potato</option>
          <option>Onion</option>
          <option>Chili</option>
          <option>Cabbage</option>
          <option>Cauliflower</option>
          <option>Brinjal</option>
          <option>Lady Finger</option>
          <option>Spinach</option>
          <option>Carrot</option>
          <option>Cucumber</option>
          <option>Pumpkin</option>
          <option>Bitter Gourd</option>
          <option>Bottle Gourd</option>
          <option>Peas</option>
          <option>Beans</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Symptom</label>
        <select class="form-select" id="symptom" required>
          <option value="">Choose...</option>
          <option>Yellowing Leaves</option>
          <option>Leaf Spots</option>
          <option>Wilting</option>
          <option>Fruits Rotting</option>
          <option>White Powder on Leaves</option>
          <option>Stunted Growth</option>
          <option>Holes in Leaves</option>
        </select>
      </div>
      <div class="col-md-12 text-center">
        <button type="submit" class="btn btn-success btn-lg">ü©∫ Diagnose</button>
      </div>
    </form>

    <div id="diagnosisResult" class="mt-5 text-center" style="display:none;">
      <h4>üß™ Diagnosis Result:</h4>
      <p id="diseaseOutput" class="lead mt-3"></p>
    </div>
  </div>
</section>

<script>
  const cropDiseases = {
    "Tomato": {
      "Yellowing Leaves": "Possible cause: Nutrient Deficiency or Fusarium Wilt. Treatment: Apply balanced fertilizer, avoid waterlogging.",
      "Leaf Spots": "Possible cause: Early Blight. Treatment: Use Mancozeb-based fungicide.",
      "White Powder on Leaves": "Powdery Mildew. Treatment: Use sulfur-based fungicide."
    },
    "Potato": {
      "Wilting": "Bacterial Wilt. Treatment: Remove affected plants, improve drainage.",
      "Leaf Spots": "Late Blight. Treatment: Spray with Metalaxyl fungicide."
    },
    "Onion": {
      "Yellowing Leaves": "Downy Mildew. Treatment: Spray fungicide and avoid overcrowding.",
      "Stunted Growth": "Mite Infestation. Treatment: Use recommended acaricide."
    },
    "Cabbage": {
      "Holes in Leaves": "Cabbage Worms. Treatment: Use neem oil or Bt pesticide."
    },
    "Cauliflower": {
      "Yellowing Leaves": "Boron deficiency. Treatment: Spray borax solution."
    },
    "Brinjal": {
      "Leaf Spots": "Bacterial Leaf Spot. Treatment: Copper-based fungicide.",
      "Wilting": "Root-knot Nematode. Treatment: Use neem cake in soil."
    },
    "Lady Finger": {
      "White Powder on Leaves": "Powdery Mildew. Treatment: Use sulfur-based fungicide."
    },
    "Chili": {
      "Fruits Rotting": "Anthracnose. Treatment: Spray fungicide before fruiting."
    },
    "Spinach": {
      "Yellowing Leaves": "Downy Mildew. Treatment: Avoid overhead watering."
    },
    "Carrot": {
      "Stunted Growth": "Nematodes. Treatment: Solarize the soil before sowing."
    },
    "Cucumber": {
      "White Powder on Leaves": "Powdery Mildew. Treatment: Spray potassium bicarbonate."
    },
    "Pumpkin": {
      "Leaf Spots": "Angular Leaf Spot. Treatment: Use copper oxychloride spray."
    },
    "Bitter Gourd": {
      "Fruits Rotting": "Fruit Fly. Treatment: Use pheromone traps."
    },
    "Bottle Gourd": {
      "Yellowing Leaves": "Nutrient deficiency or fungal rot. Treat accordingly."
    },
    "Peas": {
      "Wilting": "Fusarium Wilt. Treatment: Crop rotation and clean seeds."
    },
    "Beans": {
      "Leaf Spots": "Rust. Treatment: Mancozeb spray every 10 days."
    }
  };

  document.getElementById("cropDoctorForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const vegetable = document.getElementById("vegetable").value;
    const symptom = document.getElementById("symptom").value;
    const diagnosis = cropDiseases[vegetable]?.[symptom] || "‚ö†Ô∏è Sorry, koi data nahi mila. Try different combination.";

    document.getElementById("diseaseOutput").innerText = diagnosis;
    document.getElementById("diagnosisResult").style.display = "block";
  });
</script>

<section class="py-5 bg-success text-white" id="ai-crop-doctor">
  <div class="container d-flex flex-column align-items-center justify-content-center text-center">
    <h2 class="mb-4">üåæ WEFARM AI Crop Doctor</h2>
    <p>Upload karo hum batayenge kaunsa rog hai aur kya ilaaj hai!</p>

    <div class="row mt-4 justify-content-center w-100">
      <!-- Image Upload Panel -->
      <div class="col-md-6 col-lg-5 mb-4">
        <div class="card shadow">
          <div class="card-body text-dark">
            <h5 class="text-center">üì∏ Image-Based Disease Detection</h5>
            <p class="text-center">Apne paudhe ka photo upload karein:</p>
            <input type="file" class="form-control mb-2" id="plantImage" accept="image/*">
            <button class="btn btn-success w-100" onclick="detectByImage()">üîç Diagnose</button>
          </div>
        </div>
      </div>
    </div>

    <div id="diagnosisResult" class="mt-4 text-dark w-100 text-center"></div>
  </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.2.0"></script>


<script>
let model;
const labels = [
  "Apple___Apple_scab",
  "Apple___Black_rot",
  "Apple___Cedar_apple_rust",
  "Apple___healthy",
  // (Add all class labels from the trained model here)
];

async function loadModel() {
  model = await tf.loadLayersModel('assets/model/model.json');
  console.log("‚úÖ Model loaded successfully");
}

loadModel();

async function detectByImage() {
  const imageUpload = document.getElementById('plantImage');
  if (!imageUpload.files.length) {
    alert("üì∏ Pehle image upload karo!");
    return;
  }

  const image = document.createElement('img');
  image.src = URL.createObjectURL(imageUpload.files[0]);
  await new Promise(resolve => image.onload = resolve);

  const tensor = tf.browser.fromPixels(image)
    .resizeNearestNeighbor([224, 224])
    .toFloat()
    .div(255.0)
    .expandDims();

  const prediction = model.predict(tensor);
  const predictionArray = await prediction.data();
  const maxIndex = predictionArray.indexOf(Math.max(...predictionArray));
  const predictedClass = labels[maxIndex];

  const treatment = getTreatment(predictedClass);

  alert(`ü¶† Disease: ${predictedClass.replace(/___/g, " ‚Üí ")}\nüíä Treatment: ${treatment}`);
}

function getTreatment(disease) {
  if (disease.includes("healthy")) return "‚úÖ Paudha bilkul sahi hai!";
  if (disease.includes("Black_rot")) return "üß¥ Fungicide ka spray karein (jaise Mancozeb).";
  if (disease.includes("Leaf_mold")) return "üåø Neem oil ya copper-based fungicide lagayein.";
  if (disease.includes("Bacterial_spot")) return "üöø Pani kam karein aur bactericide spray karein.";
  // Add more treatment mappings here
  return "‚ö†Ô∏è General treatment: Pani ki safai, neem oil spray, aur healthy khad.";
}
</script>
<script>
let model;
let labels = [];

async function loadModel() {
  model = await tf.loadLayersModel("model/model.json");
  const response = await fetch("model/labels.json");
  labels = await response.json();
  console.log("‚úÖ Model & labels loaded.");
}

loadModel(); // Load model on page load

async function detectByImage() {
  const file = document.getElementById("plantImage").files[0];
  const result = document.getElementById("diagnosisResult");

  if (!file) {
    alert("Please upload an image.");
    return;
  }

  result.innerHTML = `
    <div class="alert alert-warning">
      üì° Image uploaded. AI analysis in progress...
    </div>
  `;

  const img = document.createElement("img");
  img.src = URL.createObjectURL(file);

  img.onload = async () => {
    const tensor = tf.browser.fromPixels(img)
      .resizeNearestNeighbor([224, 224])
      .toFloat()
      .expandDims();

    const prediction = model.predict(tensor);
    const predictionArray = await prediction.data();
    const maxIdx = predictionArray.indexOf(Math.max(...predictionArray));
    const detectedDisease = labels[maxIdx];

    // Example treatments - customize this later
    const treatments = {
      "Tomato___Late_blight": "‚Ä¢ Spray with Metalaxyl + Mancozeb<br>‚Ä¢ Ensure proper drainage<br>‚Ä¢ Avoid overhead irrigation",
      "Tomato___Bacterial_spot": "‚Ä¢ Apply copper-based bactericide<br>‚Ä¢ Remove infected leaves",
      "Pepper,_bell___healthy": "‚Ä¢ No disease detected. Plant looks healthy!"
    };

    result.innerHTML = `
      <div class="alert alert-success">
        ‚úÖ <strong>Detected Disease:</strong> ${detectedDisease}<br>
        ü©∫ <strong>Recommended Treatment:</strong><br>
        ${treatments[detectedDisease] || "‚Ä¢ Treatment info not available."}
      </div>
    `;
  };
}
</script>


</body>
</html>
